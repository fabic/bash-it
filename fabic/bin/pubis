#!/bin/bash
#
# https://askubuntu.com/questions/95910/command-for-determining-my-public-ip

commands=(
    # Go with a DNS query @ OpenDNS if we have the `dig` utility.
    "(type -p dig && dig +short myip.opendns.com @resolver1.opendns.com)"

    "curl -s ipinfo.io/ip"
    "(curl -s ipecho.net/plain && echo)"
    "curl -s icanhazip.com"
    "curl -s ipv4.icanhazip.com"

    "(curl -s ident.me && echo)"
    "(curl -s v4.ident.me && echo)"
    "(curl -s v6.ident.me && echo)"

    "curl -s http://checkip.amazonaws.com"
    "curl -s http://smart-ip.net/myip"

    "(wget -qO- http://ipecho.net/plain && echo)"
  )

function geekiest_method_queries_stun_server() {
  echo -en '\x00\x01\x00\x08\xc0\x0c\xee\x42\x7c\x20\x25\xa3\x3f\x0f\xa1\x7f\xfd\x7f\x00\x00\x00\x03\x00\x04\x00\x00\x00\x00' |
    nc -u -w 2 stun.services.mozilla.com 3478 |
    dd bs=1 count=4 skip=28 2>/dev/null |
    hexdump -e '1/1 "%u."' |
    sed 's/\.$/\n/'
}

for cmd in "${commands[@]}"; do
  ip="$( bash -c "${cmd}" )"
  echo "$ip  $cmd"
done
